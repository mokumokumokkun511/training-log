<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Training Log</title>

<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
<meta http-equiv="Pragma" content="no-cache" />
<meta http-equiv="Expires" content="0" />

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  background: #f2f2f7;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.app {
  max-width: 480px;
  margin: auto;
  padding: 12px;
}

h1 {
  text-align: center;
  margin-bottom: 12px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

h2 {
  font-size: 1.1em;
  margin-bottom: 8px;
}

input, select, textarea, button {
  width: 100%;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
  box-sizing: border-box;
}

input[type="date"] {
  width: 100%;
  box-sizing: border-box;
  -webkit-appearance: none;
  appearance: none;
}

button {
  background: #007aff;
  color: #fff;
  border: none;
}

button.danger { background: #ff3b30; }
button.safe { background: #34c759; }

textarea { height: 80px; }

.small {
  font-size: 0.85em;
  color: #666;
}

canvas {
  width: 100% !important;
  height: 260px !important;
}
</style>
</head>

<body>
<div class="app">
<h1>üèãÔ∏è Training Log</h1>

<!-- ÂÖ•Âäõ„Å™„Å©„ÅØÁúÅÁï•ÔºàÂâç„Å®Âêå„ÅòÔºâ -->
<!-- „Åì„Åì„ÅØ„Åù„ÅÆ„Åæ„Åæ‰Ωø„Å£„Å¶OK -->

<div class="card"><canvas id="weightChart"></canvas></div>
<div class="card"><canvas id="volumeChart"></canvas></div>
<div class="card"><canvas id="maxChart"></canvas></div>

</div>

<script>
const DATA_KEY = "training_data";
let data = JSON.parse(localStorage.getItem(DATA_KEY)) || [];

let weightChart, volumeChart, maxChart;

// Á∑öÂΩ¢ÂõûÂ∏∞
function trend(values) {
  const n = values.length;
  if (n < 2) return [];
  let sx=0, sy=0, sxy=0, sx2=0;
  values.forEach((y,x)=>{
    sx+=x; sy+=y; sxy+=x*y; sx2+=x*x;
  });
  const a = (n*sxy - sx*sy)/(n*sx2 - sx*sx);
  const b = (sy - a*sx)/n;
  return values.map((_,x)=>a*x+b);
}

function drawCharts() {
  const labels = data.map(d=>d.date);

  if (weightChart) weightChart.destroy();
  if (volumeChart) volumeChart.destroy();
  if (maxChart) maxChart.destroy();

  // ÈáçÈáè
  weightChart = new Chart(document.getElementById("weightChart"), {
    type: "line",
    data: {
      labels,
      datasets: [
        { label:"ÈáçÈáè(kg)", data:data.map(d=>d.w), borderColor:"blue" },
        { label:"ÈáçÈáè„Éà„É¨„É≥„Éâ", data:trend(data.map(d=>d.w)), borderDash:[5,5], pointRadius:0, borderColor:"blue" }
      ]
    }
  });

  // „Éú„É™„É•„Éº„É†
  volumeChart = new Chart(document.getElementById("volumeChart"), {
    data: {
      labels,
      datasets: [
        { type:"bar", label:"„Éú„É™„É•„Éº„É†", data:data.map(d=>d.volume), backgroundColor:"rgba(0,200,0,0.4)" },
        { type:"line", label:"„Éú„É™„É•„Éº„É†„Éà„É¨„É≥„Éâ", data:trend(data.map(d=>d.volume)), borderColor:"green", pointRadius:0 }
      ]
    }
  });

  // MAX
  maxChart = new Chart(document.getElementById("maxChart"), {
    type: "line",
    data: {
      labels,
      datasets: [
        { label:"MAX(kg)", data:data.map(d=>d.m), borderColor:"red" },
        { label:"MAX„Éà„É¨„É≥„Éâ", data:trend(data.map(d=>d.m)), borderDash:[5,5], pointRadius:0, borderColor:"red" }
      ]
    }
  });
}

drawCharts();
</script>
</body>
</html>
