<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Training Log</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  margin: 0;
  background: #f2f2f7;
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
}

.app {
  max-width: 480px;
  margin: auto;
  padding: 12px;
}

h1 {
  text-align: center;
  margin-bottom: 12px;
}

.card {
  background: #fff;
  border-radius: 12px;
  padding: 14px;
  margin-bottom: 12px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.06);
}

h2 {
  font-size: 1.1em;
  margin-bottom: 8px;
}

label {
  display: block;
  font-size: 0.9em;
  color: #555;
  margin-bottom: 4px;
}

input, select, textarea, button {
  width: 100%;
  height: 44px;
  padding: 10px;
  margin-bottom: 8px;
  border-radius: 8px;
  border: 1px solid #ccc;
  font-size: 16px;
  box-sizing: border-box;
}

input[type="date"] {
  appearance: none;
  -webkit-appearance: none;
  background-color: #fff;
}

button {
  background: #007aff;
  color: #fff;
  border: none;
}

button.danger {
  background: #ff3b30;
}

textarea {
  height: 80px;
}

canvas {
  width: 100% !important;
  height: 260px !important;
}
/* ===== å…¥åŠ›æ¬„ã‚µã‚¤ã‚ºçµ±ä¸€ï¼ˆç‰¹ã«æ—¥ä»˜ï¼‰ ===== */
input,
select {
  box-sizing: border-box;
  width: 100%;
  height: 44px;
  padding: 6px 10px;
  font-size: 16px;
}

/* Safariå¯¾ç­–ï¼šdateã ã‘å¾®èª¿æ•´ */
input[type="date"] {
  appearance: none;
  -webkit-appearance: none;
  background-color: #fff;
}
</style>
</head>

<body>
<div class="app">
  <h1>ğŸ‹ï¸ Training Log</h1>

  <div class="card">
    <h2>å…¥åŠ›</h2>

    <label for="date">æ—¥ä»˜</label>
    <input id="date" type="date" />

    <input id="weight" type="number" placeholder="é‡é‡ (kg)" />
    <input id="reps" type="number" placeholder="å›æ•°" />
    <input id="sets" type="number" placeholder="ã‚»ãƒƒãƒˆ" />
    <input id="max" type="number" placeholder="MAXæ¸¬å®š (kg)" />

    <button id="saveBtn">ä¿å­˜</button>
  </div>

  <div class="card">
    <h2>æ—¥ä»˜æŒ‡å®šã§å‰Šé™¤</h2>
    <select id="deleteDate"></select>
    <button class="danger" id="deleteBtn">å‰Šé™¤</button>
  </div>

  <div class="card">
    <h2>ğŸ“ˆ é‡é‡</h2>
    <canvas id="weightChart"></canvas>
  </div>

  <div class="card">
    <h2>ğŸ“ˆ ãƒœãƒªãƒ¥ãƒ¼ãƒ </h2>
    <canvas id="volumeChart"></canvas>
  </div>

  <div class="card">
    <h2>ğŸ“ˆ MAX</h2>
    <canvas id="maxChart"></canvas>
  </div>
</div>

<script>
const DATA_KEY = "training_data";
let data = JSON.parse(localStorage.getItem(DATA_KEY)) || [];

let weightChart, volumeChart, maxChart;

const dateEl = document.getElementById("date");
const weightEl = document.getElementById("weight");
const repsEl = document.getElementById("reps");
const setsEl = document.getElementById("sets");
const maxEl = document.getElementById("max");

document.getElementById("saveBtn").onclick = saveData;
document.getElementById("deleteBtn").onclick = deleteByDate;

// ä»Šæ—¥ã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ—¥ä»˜ã«
dateEl.value = new Date().toISOString().slice(0,10);

function saveData() {
  const date = dateEl.value;
  const w = +weightEl.value;
  const r = +repsEl.value;
  const s = +setsEl.value;
  const m = +maxEl.value;
  if (!date || !w || !r || !s || !m) return;

  const index = data.findIndex(d => d.date === date);

  if (index >= 0) {
    // æ—¢å­˜æ—¥ä»˜ â†’ åˆç®—
    const old = data[index];

    const totalReps = old.r + r;
    const totalSets = old.s + s;

    const avgWeight =
      ((old.w * old.r * old.s) + (w * r * s)) /
      (old.r * old.s + r * s);

    const maxValue = Math.max(old.m, m);

    const volume = avgWeight * totalReps * totalSets;

    data[index] = {
      date,
      w: Math.round(avgWeight * 10) / 10,
      r: totalReps,
      s: totalSets,
      m: maxValue,
      volume
    };
  } else {
    // æ–°è¦æ—¥ä»˜
    const volume = w * r * s;
    data.push({ date, w, r, s, m, volume });
  }

  localStorage.setItem(DATA_KEY, JSON.stringify(data));
  clearInputs();
  refresh();
}

function clearInputs() {
  weightEl.value = repsEl.value = setsEl.value = maxEl.value = "";
  weightEl.focus();
}

function deleteByDate() {
  const d = document.getElementById("deleteDate").value;
  data = data.filter(x => x.date !== d);
  localStorage.setItem(DATA_KEY, JSON.stringify(data));
  refresh();
}

function refresh() {
  updateDeleteList();
  drawCharts();
}

function updateDeleteList() {
  const sel = document.getElementById("deleteDate");
  sel.innerHTML = "";
  [...new Set(data.map(d => d.date))].forEach(d => {
    const o = document.createElement("option");
    o.value = o.textContent = d;
    sel.appendChild(o);
  });
}

function drawCharts() {
  if (weightChart) weightChart.destroy();
  if (volumeChart) volumeChart.destroy();
  if (maxChart) maxChart.destroy();

  const labels = data.map(d => d.date);

  weightChart = new Chart(
    document.getElementById("weightChart"),
    lineConfig(labels, data.map(d => d.w), "é‡é‡ (kg)", "blue")
  );

  volumeChart = new Chart(
    document.getElementById("volumeChart"),
    lineConfig(labels, data.map(d => d.volume), "ãƒœãƒªãƒ¥ãƒ¼ãƒ ", "green")
  );

  maxChart = new Chart(
    document.getElementById("maxChart"),
    lineConfig(labels, data.map(d => d.m), "MAX (kg)", "red")
  );
}

function lineConfig(labels, values, label, color) {
  return {
    type: "line",
    data: {
      labels,
      datasets: [{
        label,
        data: values,
        borderColor: color,
        tension: 0.25,
        fill: false
      }]
    }
  };
}

refresh();
</script>
</body>
</html>
