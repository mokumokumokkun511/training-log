<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Training Log</title>

<!-- Chart.jsï¼ˆå¿…é ˆï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: -apple-system, BlinkMacSystemFont, sans-serif;
  margin: 0;
  padding: 12px;
  background: #f5f5f5;
}
h2 { margin-top: 24px; }

input, button {
  width: 100%;
  padding: 8px;
  margin: 4px 0;
  font-size: 16px;
}

button {
  background: #007aff;
  color: #fff;
  border: none;
  border-radius: 6px;
}

canvas {
  background: #fff;
  margin-top: 16px;
}
</style>
</head>

<body>

<h1>ğŸ‹ï¸ ãƒˆãƒ¬ãƒ¼ãƒ‹ãƒ³ã‚°è¨˜éŒ²</h1>

<label>æ—¥ä»˜</label>
<input type="date" id="date">

<label>é‡é‡</label>
<input type="number" id="weight">

<label>å›æ•°</label>
<input type="number" id="reps">

<label>ã‚»ãƒƒãƒˆ</label>
<input type="number" id="sets">

<label>ãƒãƒƒã‚¯ã‚¹</label>
<input type="number" id="max">

<button onclick="addData()">è¿½åŠ </button>

<label>æ—¥ä»˜å‰Šé™¤</label>
<input type="date" id="deleteDate">
<button onclick="deleteByDate()">å‰Šé™¤</button>

<h2>é‡é‡</h2>
<canvas id="weightChart"></canvas>

<h2>ãƒœãƒªãƒ¥ãƒ¼ãƒ </h2>
<canvas id="volumeChart"></canvas>

<h2>ãƒãƒƒã‚¯ã‚¹</h2>
<canvas id="maxChart"></canvas>

<script>
let data = JSON.parse(localStorage.getItem("trainingData") || "[]");

function save() {
  localStorage.setItem("trainingData", JSON.stringify(data));
}

function addData() {
  const d = date.value;
  if (!d) return alert("æ—¥ä»˜å…¥ã‚Œã¦ï¼");

  data.push({
    date: d,
    weight: +weight.value,
    reps: +reps.value,
    sets: +sets.value,
    max: +max.value
  });

  save();
  drawAll();
}

function deleteByDate() {
  const d = deleteDate.value;
  data = data.filter(x => x.date !== d);
  save();
  drawAll();
}

function trend(values) {
  const n = values.length;
  if (n < 2) return values;

  const x = [...Array(n).keys()];
  const avgX = x.reduce((a,b)=>a+b,0)/n;
  const avgY = values.reduce((a,b)=>a+b,0)/n;

  const slope = x.reduce((s,i)=>s+(i-avgX)*(values[i]-avgY),0) /
                x.reduce((s,i)=>s+(i-avgX)**2,0);

  return x.map(i => avgY + slope*(i-avgX));
}

let charts = {};

function drawChart(id, label, values) {
  if (charts[id]) charts[id].destroy();

  charts[id] = new Chart(
    document.getElementById(id),
    {
      type: "line",
      data: {
        labels: data.map(d => d.date),
        datasets: [
          {
            label,
            data: values,
            borderWidth: 2
          },
          {
            label: "è¿‘ä¼¼æ›²ç·š",
            data: trend(values),
            borderDash: [5,5],
            borderWidth: 2
          }
        ]
      }
    }
  );
}

function drawAll() {
  drawChart(
    "weightChart",
    "é‡é‡",
    data.map(d => d.weight)
  );

  drawChart(
    "volumeChart",
    "ãƒœãƒªãƒ¥ãƒ¼ãƒ ",
    data.map(d => d.weight * d.reps * d.sets)
  );

  drawChart(
    "maxChart",
    "ãƒãƒƒã‚¯ã‚¹",
    data.map(d => d.max)
  );
}

drawAll();
</script>

</body>
</html>
